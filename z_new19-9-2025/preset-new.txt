Case,Symbol,K_swing,N_bos,LookbackInternal,M_retest,EqTol_ATR_Mult,BOSBuffer_ATR_Mult,UseKillzones,UseRoundNumber,UseVSA,RNDelta_ATR_Mult,L_percentile,RiskPerTradePct,TP1_R,TP2_R,BE_Activate_R,PartialClosePct,TimeStopMinutes,MinProgressR,MaxSpread_ATR_Mult,MaxOpenPositions,UsePendingRetest,RetestOffset_ATR_Mult,PendingExpirySec,UseTrailing,TrailMode,TrailATRPeriod,TrailATRMult,TrailStep_ATR_Mult,TrailStartRR,UsePyramid,MaxAdds,AddSpacing_ATR_Mult,AddSizeFactor,CooldownSec


Preset Mẫu với Giá trị Khởi điểm & Giải thích
Đây là một bộ giá trị gợi ý để bạn bắt đầu quá trình tối ưu hóa.

Parameter	Starting Value	Ghi chú và Giải thích
Case	1001	ID của preset.
Symbol	EURUSD	Thay đổi cho từng thị trường bạn muốn test.
K_swing	50	(Core Logic) Số nến để xác định đỉnh/đáy swing. Cần tối ưu hóa.
N_bos	6	(Core Logic) Số nến tối đa để tìm BOS sau khi có sweep. Cần tối ưu hóa.
LookbackInternal	15	(Core Logic) Số nến để tìm đỉnh/đáy nội bộ (internal high/low). Cần tối ưu hóa.
M_retest	3	(Core Logic) Số nến chờ giá retest lại vùng BOS.
EqTol_ATR_Mult	0.1	(Mới) Khoan dung cho đỉnh/đáy bằng nhau. 0.1 nghĩa là chênh lệch không quá 10% ATR.
BOSBuffer_ATR_Mult	0.05	(Mới) Vùng đệm phá vỡ BOS. 0.05 nghĩa là giá cần phá qua mức cản 5% ATR. Rất nhỏ để bắt tín hiệu sớm.
UseKillzones	TRUE	Quan trọng: Đặt là TRUE cho Forex/XAU. Đặt là FALSE cho Crypto (vì Crypto chạy 24/7).
UseRoundNumber	TRUE	Giữ nguyên, logic trong code đã xử lý tốt cho các loại symbol khác nhau.
UseVSA	FALSE	Bật/tắt tùy theo chiến lược.
RNDelta_ATR_Mult	0.2	(Thay thế) Khoảng cách đến số tròn được tính bằng 20% ATR.
L_percentile	150	Tham số cho VSA.
RiskPerTradePct	0.5	Quản lý rủi ro, giữ nguyên.
TP1_R, TP2_R, BE_Activate_R	1.0, 2.0, 0.8	Các tỷ lệ R:R, đã tự thích ứng. Cần tối ưu hóa.
PartialClosePct	50	Giữ nguyên.
TimeStopMinutes	120	Giữ nguyên.
MinProgressR	0.5	(Thay thế) Yêu cầu R:R tối thiểu để giữ lệnh sau TimeStop. Cần tối ưu hóa.
MaxSpread_ATR_Mult	0.15	(Thay thế) Spread tối đa cho phép là 15% ATR. Rất hiệu quả để lọc nhiễu khi thị trường giãn spread.
MaxOpenPositions	1	Giữ nguyên.
UsePendingRetest	TRUE	Bật/tắt tùy theo phong cách vào lệnh.
RetestOffset_ATR_Mult	0.1	(Thay thế) Đặt lệnh pending cách vùng retest một khoảng 10% ATR.
PendingExpirySec	300	Giữ nguyên.
UseTrailing	TRUE	Bật/tắt trailing stop.
TrailMode	1	Chế độ 1 là TRAIL_ATR, hoàn toàn phù hợp.
TrailATRPeriod	14	Giữ nguyên.
TrailATRMult	2	Khoảng cách trailing stop bằng 2 lần ATR. Cần tối ưu hóa.
TrailStartRR	1	Kích hoạt trailing khi đạt R:R = 1.
UsePyramid	FALSE	Bật/tắt nhồi lệnh.
MaxAdds	2	Giữ nguyên.
AddSpacing_ATR_Mult	0.8	(Thay thế) Nhồi lệnh khi giá đi được 0.8 lần ATR. Cần tối ưu hóa.
AddSizeFactor	0.5	Giữ nguyên.
CooldownSec	60	Giữ nguyên.



Tóm tắt các bước tiếp theo cho bạn:
Cập nhật Code:

Xóa hoặc ẩn input UseATRScaling và mặc định nó bằng true.

Thêm các input mới với đuôi _ATR_Mult như trong cấu trúc ở trên.

Trong code, tại những chỗ đang dùng SL_BufferUSD, RetestOffsetUSD..., hãy thay thế bằng phép tính SL_ATR_Mult * current_ATR_value, RetestOffset_ATR_Mult * current_ATR_value...

Chuẩn bị File Preset: Tạo một file CSV mới với header như trên.

Chạy Tối Ưu Hóa:

Chạy riêng cho EURUSD M15, tối ưu các tham số quan trọng (K_swing, N_bos, ..._ATR_Mult, TP_R...).

Chạy riêng cho XAUUSD M1, cũng tối ưu các tham số tương tự.

Chạy riêng cho BTCUSD H1 (ví dụ), nhớ đặt UseKillzones = FALSE.

Bằng cách này, bạn đang xây dựng một nền tảng vững chắc và có phương pháp luận rõ ràng. Kết quả backtest sẽ trở nên đáng tin cậy hơn và bạn sẽ sớm tìm ra những bộ preset tối ưu cho từng thị trường.